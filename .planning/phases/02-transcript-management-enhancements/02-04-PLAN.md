---
phase: 02-transcript-management-enhancements
plan: 04
type: execute
wave: 3
depends_on: ["02-02"]
files_modified:
  - src/components/TranscriptionModal.tsx
  - src/lib/transcription/export.ts (new)
  - src/lib/transcription/commands.ts (optional)
autonomous: true
must_haves:
  truths:
    - "User can export transcript to multiple formats (SRT, VTT, JSON)"
  artifacts:
    - path: "src/components/TranscriptionModal.tsx"
      provides: "Export buttons/dropdown for SRT, VTT, JSON"
      contains: "export.*SRT"
    - path: "src/lib/transcription/export.ts"
      provides: "Format conversion functions"
      exports: ["toSRT", "toVTT", "toJSON"]
  key_links:
    - from: "src/components/TranscriptionModal.tsx"
      to: "src/lib/transcription/export.ts"
      via: "import and function calls"
      pattern: "import.*export"
    - from: "src/lib/transcription/export.ts"
      to: "src/lib/transcription/types.ts"
      via: "Transcript type import"
      pattern: "import.*Transcript"
---

<objective>
Add export functionality to download transcripts in subtitle and structured formats.

Purpose: Enable users to use transcripts in other applications (video editors, subtitling tools, analysis).
Output: Export buttons in TranscriptionModal, conversion utilities for SRT, VTT, JSON.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing transcript data structure with word timestamps
@src/lib/transcription/types.ts
@src/components/TranscriptionModal.tsx
</context>

<tasks>

<task type="auto">
<name>Task 1: Implement format conversion utilities</name>
<files>src/lib/transcription/export.ts</files>
<action>
Create a new file `src/lib/transcription/export.ts` with three conversion functions:

1. `toSRT(transcript: Transcript): string`
   - Convert word timestamps to SRT subtitle format.
   - SRT format: subtitle index, timecode (HH:MM:SS,mmm --> HH:MM:SS,mmm), text line(s).
   - Use word timestamps to create segments: group consecutive words within reasonable time gap (e.g., 0.5s) or create one subtitle per word? Simpler: create subtitles for each sentence (but we don't have sentences). Use word‑level timestamps to create subtitles with up to 5‑word chunks.
   - Implement simple algorithm: iterate words, accumulate until total duration > 3 seconds or word count > 5, then create subtitle with start of first word, end of last word.
   - Format timecodes: `start.toFixed(3).replace('.', ',')` (SRT uses commas for milliseconds).
   - Return concatenated subtitles.

2. `toVTT(transcript: Transcript): string`
   - Similar to SRT but with "WEBVTT" header and timecode format HH:MM:SS.mmm.
   - Use same segmentation logic.

3. `toJSON(transcript: Transcript): string`
   - Return JSON.stringify(transcript, null, 2) (or enriched JSON with segments).
   - Include metadata like export date.

Also create a helper function `downloadFile(content: string, filename: string)` that creates a Blob and triggers download (similar to existing download in TranscriptionModal).

Reference existing download logic in TranscriptionModal.
</action>
<verify>
- Write unit tests or manual test by running Node? Can test in browser console.
- Ensure functions produce valid SRT/VTT syntax.
- Check that time conversions are correct.
</verify>
<done>
Export module exists with three working conversion functions.
</done>
</task>

<task type="auto">
<name>Task 2: Add export UI to TranscriptionModal</name>
<files>src/components/TranscriptionModal.tsx</files>
<action>
1. Import export functions: `import { toSRT, toVTT, toJSON } from '@/lib/transcription/export'`
2. Add an "Export" button next to Copy/Download buttons (or a dropdown menu).
   - Options: Simple approach: three separate buttons labeled "Export SRT", "Export VTT", "Export JSON".
   - Or a single "Export" button with dropdown (requires adding a dropdown component). Use simple separate buttons for now.
3. For each format, add a button with onClick handler:
   - `handleExportSRT = () => { const content = toSRT(transcript); downloadFile(content, `transcript_${Date.now()}.srt`); }`
   - Similarly for VTT and JSON.
4. Style buttons consistently with existing ones (same Tailwind classes).
5. Ensure buttons are disabled when in edit mode.

Consider adding a tooltip explaining each format.
</action>
<verify>
- Open transcription modal.
- See new export buttons.
- Click each button, check that file downloads with correct content and filename.
- Verify file content matches format.
</verify>
<done>
TranscriptionModal has working export buttons for SRT, VTT, and JSON.
</done>
</task>

<task type="auto">
<name>Task 3: Test export functionality end‑to‑end</name>
<files>src/components/TranscriptionModal.tsx, src/lib/transcription/export.ts</files>
<action>
1. Create a comprehensive test with a sample transcript (from actual transcription).
2. Verify each exported file opens correctly in relevant software (e.g., video player for SRT, text editor for JSON).
3. Ensure edge cases handled: empty words list, single word, long transcripts.
4. Add error handling: if conversion fails, show toast error.

Manual test steps:
- Transcribe a recording.
- Open transcript modal.
- Export each format, open downloaded files, verify correctness.
- Test with a transcript that has many words (stress test segmentation).
- Verify downloaded filenames include timestamp or recording name.

Optionally add unit tests for export functions (if project has test setup). Not required.
</action>
<verify>
- Export SRT: open in subtitle editor (e.g., VLC) to confirm timecodes align.
- Export VTT: validate with online validator.
- Export JSON: parse JSON, ensure all fields present.
</verify>
<done>
All three export formats work correctly and produce usable files.
</done>
</task>

</tasks>

<verification>
1. Transcribe a recording with word‑level timestamps.
2. Open transcript modal.
3. Click "Export SRT" – download .srt file, open in text editor, confirm SRT format.
4. Repeat for VTT and JSON.
5. Verify that exported files contain correct transcript text and timestamps.
</verification>

<success_criteria>
- User can export transcript in SRT, VTT, and JSON formats.
- Exported files are syntactically correct and usable in standard tools.
- No regression to existing copy/download .txt functionality.
</success_criteria>

<output>
After completion, create `.planning/phases/02-transcript-management-enhancements/02-04-SUMMARY.md`
</output>