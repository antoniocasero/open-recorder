---
phase: 01-transcription-mvp
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src-tauri/Cargo.toml
  - src-tauri/tauri.conf.json
  - src/lib/transcription/types.ts
autonomous: true
user_setup:
  - service: openai
    why: "Transcription via Whisper API"
    env_vars:
      - name: OPENAI_API_KEY
        source: "OpenAI Dashboard → API keys → Create new secret key"
    dashboard_config:
      - task: "Ensure account has credits"
        location: "OpenAI Dashboard → Usage → Billing"

must_haves:
  truths:
    - "App has permission to make HTTP requests to OpenAI API"
    - "Transcript data structures are defined for frontend use"
  artifacts:
    - path: "src-tauri/Cargo.toml"
      provides: "async-openai and tokio dependencies"
      contains: 'async-openai = "0.32.3"'
    - path: "src-tauri/tauri.conf.json"
      provides: "HTTP permission for api.openai.com"
      contains: '"allow": ["https://api.openai.com"]'
    - path: "src/lib/transcription/types.ts"
      provides: "Transcript and WordTimestamp interfaces"
      min_lines: 20
  key_links:
    - from: "src/lib/transcription/types.ts"
      to: "src/components/TranscriptionModal.tsx (future)"
      via: "import"
      pattern: "import.*Transcript"
    - from: "src-tauri/Cargo.toml"
      to: "src-tauri/src/commands/transcription.rs (future)"
      via: "dependency"
      pattern: "async-openai"
---

<objective>
Add foundational dependencies, configuration, and types for transcription feature.

Purpose: Enable secure HTTP requests to OpenAI Whisper API and define TypeScript interfaces for transcript data.
Output: Updated Cargo.toml with async-openai, tauri.conf.json with API permission, and transcript types file.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-transcription-mvp/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Rust dependencies</name>
  <files>src-tauri/Cargo.toml</files>
  <action>
    Add the following dependencies to `[dependencies]` section:
    
    ```toml
    async-openai = "0.32.3"
    tokio = { version = "1.49", features = ["full"] }
    thiserror = "2.0"
    tracing = "0.1"
    ```
    
    Run `cargo check` to ensure dependencies resolve. If the project uses workspace, add to workspace Cargo.toml.
    
    **Why:** `async-openai` is the recommended Rust client for OpenAI APIs; `tokio` provides async runtime; `thiserror` for ergonomic error handling; `tracing` for structured logging.
  </action>
  <verify>`cargo check` runs without errors</verify>
  <done>Cargo.toml updated and cargo check passes</done>
</task>

<task type="auto">
  <name>Task 2: Add Tauri capability for OpenAI API</name>
  <files>src-tauri/tauri.conf.json</files>
  <action>
    Add HTTP permission for OpenAI API in the security configuration.
    
    In `tauri.conf.json`, locate the `"security"` object (under `"app"`). Add an `"allow"` array if not present, or extend existing:
    
    ```json
    "security": {
      "csp": "...",
      "assetProtocol": { ... },
      "allow": [
        {
          "url": "https://api.openai.com"
        }
      ]
    }
    ```
    
    Ensure the `"csp"` already includes `default-src 'self'` (should be fine). Save file.
    
    **Why:** Tauri restricts external HTTP calls; this grants permission for the backend to call OpenAI's API.
  </action>
  <verify>Check tauri.conf.json contains "allow" array with "https://api.openai.com"</verify>
  <done>Tauri app can make HTTP requests to api.openai.com</done>
</task>

<task type="auto">
  <name>Task 3: Create frontend transcript types</name>
  <files>src/lib/transcription/types.ts</files>
  <action>
    Create directory `src/lib/transcription/` if it doesn't exist.
    Create file `src/lib/transcription/types.ts` with the following content:
    
    ```typescript
    export interface WordTimestamp {
      word: string
      start: number
      end: number
    }
    
    export interface Transcript {
      text: string
      words: WordTimestamp[]
      duration: number
      language: string
    }
    
    export type TranscriptionStatus =
      | 'idle'
      | 'loading'
      | 'success'
      | 'error'
    
    export interface TranscriptionState {
      status: TranscriptionStatus
      transcript?: Transcript
      error?: string
    }
    ```
    
    **Why:** Standardized types for frontend‑backend communication and UI state.
  </action>
  <verify>File exists and exports WordTimestamp, Transcript, TranscriptionStatus, TranscriptionState</verify>
  <done>TypeScript types are available for import</done>
</task>

</tasks>

<verification>
- Run `cargo check` in `src-tauri/` directory – no errors.
- Validate tauri.conf.json syntax with `tauri info`.
- TypeScript compilation passes (`npm run build` or `tsc --noEmit`).
</verification>

<success_criteria>
1. `async-openai` and `tokio` appear in Cargo.toml dependencies.
2. `tauri.conf.json` includes allow rule for `https://api.openai.com`.
3. `src/lib/transcription/types.ts` exists and exports the four interfaces.
4. No compilation errors in Rust or TypeScript.
</success_criteria>

<output>
After completion, create `.planning/phases/01-transcription-mvp/01-01-SUMMARY.md`
</output>