---
phase: 01-transcription-mvp
plan: 04
type: execute
wave: 3
depends_on: ["01-02", "01-03"]
files_modified:
  - src/components/TranscriptionModal.tsx
  - src/components/RecordingsList.tsx
  - package.json
  - src/components/Dashboard.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can view transcript in a modal with word‑level timestamps"
    - "Toast notification appears when transcription finishes"
    - "Modal opens when transcription completes"
  artifacts:
    - path: "src/components/TranscriptionModal.tsx"
      provides: "Modal dialog displaying transcript"
      min_lines: 50
    - path: "package.json"
      provides: "react‑hot‑toast dependency"
      contains: "react-hot-toast"
    - path: "src/components/RecordingsList.tsx"
      provides: "Modal trigger on transcription success"
      contains: "setShowTranscriptModal"
  key_links:
    - from: "src/components/TranscriptionModal.tsx"
      to: "src/lib/transcription/types.ts"
      via: "import"
      pattern: "import.*Transcript"
    - from: "src/components/RecordingsList.tsx"
      to: "src/components/TranscriptionModal.tsx"
      via: "import"
      pattern: "TranscriptionModal"
    - from: "src/components/RecordingsList.tsx"
      to: "toast notification"
      via: "toast.success"
      pattern: "toast\\."
---

<objective>
Create transcript modal display, install toast notifications, and connect UI to show transcripts upon completion.

Purpose: Give users a clear view of transcription results with timestamps and provide immediate feedback via toast.
Output: Functional modal, toast system, and integration with existing transcription button.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-transcription-mvp/01-RESEARCH.md
@.planning/phases/01-transcription-mvp/01-01-SUMMARY.md
@.planning/phases/01-transcription-mvp/01-02-SUMMARY.md
@.planning/phases/01-transcription-mvp/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react‑hot‑toast</name>
  <files>package.json</files>
  <action>
    Install `react‑hot‑toast` and its TypeScript types:
    
    ```bash
    npm install react-hot-toast
    ```
    
    Verify that `package.json` lists `react‑hot‑toast` in dependencies (version `^2.5.0` or later).
    
    **Why:** Lightweight, customizable toast library that integrates easily with React.
  </action>
  <verify>`package.json` includes "react-hot-toast" and node_modules contains the package</verify>
  <done>Toast library ready for import</done>
</task>

<task type="auto">
  <name>Task 2: Create TranscriptionModal component</name>
  <files>src/components/TranscriptionModal.tsx</files>
  <action>
    Create `src/components/TranscriptionModal.tsx` with the following content:
    
    ```tsx
    'use client'
    
    import { X, Copy, Download } from 'lucide-react'
    import { Transcript } from '@/lib/transcription/types'
    import { useState } from 'react'
    
    interface TranscriptionModalProps {
      transcript: Transcript
      onClose: () => void
    }
    
    export function TranscriptionModal({ transcript, onClose }: TranscriptionModalProps) {
      const [copied, setCopied] = useState(false)
    
      const handleCopy = async () => {
        await navigator.clipboard.writeText(transcript.text)
        setCopied(true)
        setTimeout(() => setCopied(false), 2000)
      }
    
      const handleDownload = () => {
        const blob = new Blob([transcript.text], { type: 'text/plain' })
        const url = URL.createObjectURL(blob)
        const a = document.createElement('a')
        a.href = url
        a.download = `transcript_${new Date().toISOString().slice(0, 10)}.txt`
        document.body.appendChild(a)
        a.click()
        document.body.removeChild(a)
        URL.revokeObjectURL(url)
      }
    
      return (
        <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
          <div className="bg-[#252525] rounded-lg border border-[#333] w-full max-w-2xl max-h-[80vh] flex flex-col">
            {/* Header */}
            <div className="flex items-center justify-between p-4 border-b border-[#333]">
              <div>
                <h3 className="text-lg font-semibold">Transcript</h3>
                <p className="text-sm text-gray-400">
                  {transcript.language} · {transcript.words.length} words · {transcript.duration.toFixed(1)}s
                </p>
              </div>
              <button
                onClick={onClose}
                className="p-1 hover:bg-[#333] rounded transition-colors"
              >
                <X className="w-5 h-5" />
              </button>
            </div>
    
            {/* Body */}
            <div className="flex-1 overflow-y-auto p-4">
              {/* Word‑by‑word display with timestamps */}
              <div className="space-y-2">
                {transcript.words.map((word, idx) => (
                  <div
                    key={idx}
                    className="inline-flex items-center bg-[#2a2a2a] rounded px-2 py-1 mr-2 mb-2 border border-[#333]"
                    title={`${word.start.toFixed(2)}s – ${word.end.toFixed(2)}s`}
                  >
                    <span className="text-sm">{word.word}</span>
                    <span className="text-xs text-gray-500 ml-1">
                      {word.start.toFixed(1)}s
                    </span>
                  </div>
                ))}
              </div>
    
              {/* Plain text block */}
              <div className="mt-6 pt-4 border-t border-[#333]">
                <p className="text-sm text-gray-300 whitespace-pre-wrap">{transcript.text}</p>
              </div>
            </div>
    
            {/* Footer */}
            <div className="p-4 border-t border-[#333] flex items-center justify-between">
              <div className="text-xs text-gray-500">
                Click a word to seek in audio (future feature)
              </div>
              <div className="flex items-center gap-2">
                <button
                  onClick={handleCopy}
                  className="flex items-center gap-2 px-3 py-1.5 bg-[#2a2a2a] rounded border border-[#333] hover:bg-[#333] transition-colors"
                >
                  <Copy className="w-4 h-4" />
                  <span className="text-sm">{copied ? 'Copied!' : 'Copy'}</span>
                </button>
                <button
                  onClick={handleDownload}
                  className="flex items-center gap-2 px-3 py-1.5 bg-[#2a2a2a] rounded border border-[#333] hover:bg-[#333] transition-colors"
                >
                  <Download className="w-4 h-4" />
                  <span className="text-sm">Download .txt</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      )
    }
    ```
    
    **Why:** Provides a rich, interactive view of the transcript with timestamps and export options.
  </action>
  <verify>Component renders without errors; exports TranscriptionModal</verify>
  <done>Modal component ready for use</done>
</task>

<task type="auto">
  <name>Task 3: Integrate toast and modal into RecordingsList</name>
  <files>src/components/RecordingsList.tsx</files>
  <action>
    Update `RecordingsList.tsx` to:
    
    1. Import toast and modal:
    
    ```typescript
    import toast, { Toaster } from 'react-hot-toast'
    import { TranscriptionModal } from './TranscriptionModal'
    ```
    
    2. Add state for modal visibility and current transcript:
    
    ```typescript
    const [showTranscriptModal, setShowTranscriptModal] = useState(false)
    const [currentTranscript, setCurrentTranscript] = useState<Transcript | null>(null)
    ```
    
    3. Modify `handleTranscribe` to show toast and open modal on success:
    
    ```typescript
    const handleTranscribe = async (recording: AudioItem) => {
      setTranscriptionStates(prev => ({
        ...prev,
        [recording.id]: { status: 'loading' }
      }))
      
      try {
        const transcript = await transcribeAudio(recording.path)
        setTranscriptionStates(prev => ({
          ...prev,
          [recording.id]: { status: 'success', transcript }
        }))
        
        // Show success toast
        toast.success('Transcription complete!', {
          duration: 4000,
        })
        
        // Open modal with transcript
        setCurrentTranscript(transcript)
        setShowTranscriptModal(true)
      } catch (error) {
        setTranscriptionStates(prev => ({
          ...prev,
          [recording.id]: { status: 'error', error: error instanceof Error ? error.message : String(error) }
        }))
        
        // Show error toast
        toast.error(`Transcription failed: ${error instanceof Error ? error.message : String(error)}`, {
          duration: 5000,
        })
      }
    }
    ```
    
    4. Add `<Toaster />` component near the end of the RecordingsList JSX (or better, at the app root). For simplicity, add inside the RecordingsList's parent container (Dashboard). Since RecordingsList is used inside Dashboard, we can add `<Toaster />` to Dashboard component (outside RecordingsList). We'll do that in a separate step; for now, add a comment.
    
    5. Render the modal conditionally:
    
    ```tsx
    {showTranscriptModal && currentTranscript && (
      <TranscriptionModal
        transcript={currentTranscript}
        onClose={() => {
          setShowTranscriptModal(false)
          setCurrentTranscript(null)
        }}
      />
    )}
    ```
    
    6. Add `<Toaster />` to Dashboard.tsx (outside RecordingsList). Open Dashboard.tsx and add import and component:
    
    ```tsx
    import { Toaster } from 'react-hot-toast'
    ```
    
    Insert `<Toaster />` inside the main div, before closing tag:
    
    ```tsx
    <div className="min-h-screen bg-[#1a1a1a] text-white p-6">
      {/* ... existing content ... */}
      <Toaster position="bottom-right" />
    </div>
    ```
    
    **Why:** Completes the user flow with immediate feedback and detailed transcript viewing.
  </action>
  <verify>Toasts appear on success/error; modal opens with transcript; Dashboard includes Toaster</verify>
  <done>Full UI feedback loop functional</done>
</task>

</tasks>

<verification>
- Start dev server, trigger transcription (with valid API key). Toast appears, modal opens.
- Without API key, error toast appears.
- Modal displays word timestamps, copy and download buttons work.
</verification>

<success_criteria>
1. `react‑hot‑toast` installed and used for success/error notifications.
2. `TranscriptionModal` component exists and displays transcript with timestamps.
3. Successful transcription opens modal and shows success toast.
4. Transcription failure shows error toast.
</success_criteria>

<output>
After completion, create `.planning/phases/01-transcription-mvp/01-04-SUMMARY.md`
</output>