---
phase: 03-advanced-features-scalability
plan: 06
type: execute
wave: 4
depends_on: ["03-02", "03-03", "03-04", "03-05"]
files_modified:
  - app/library/page.tsx
  - app/editor/page.tsx
  - src/components/RecordingsTable.tsx
  - src/components/PlayerSidebar.tsx
  - src/components/Header.tsx
  - src/components/Footer.tsx
  - app/globals.css
autonomous: true
must_haves:
  truths:
    - "Clicking a row in Library table navigates to Editor page with that recording's ID"
    - "Editor page loads the correct recording data based on query parameter"
    - "Header's New Recording button appears only on Library page"
    - "Custom scrollbar styles apply throughout the app"
    - "All pages use consistent color palette and typography"
  artifacts:
    - path: "app/library/page.tsx"
      provides: "Library page with navigation to editor"
      contains: "router.push.*editor"
    - path: "app/editor/page.tsx"
      provides: "Editor page that loads recording from query param"
      contains: "useSearchParams.*recording"
    - path: "src/components/RecordingsTable.tsx"
      provides: "Row click handler that navigates"
      contains: "onClick.*recording.id"
    - path: "src/components/Header.tsx"
      provides: "Conditional New Recording button"
      contains: "pathname.*library"
    - path: "app/globals.css"
      provides: "Custom scrollbar and global styles"
      contains: ".custom-scrollbar"
  key_links:
    - from: "src/components/RecordingsTable.tsx"
      to: "next/navigation"
      via: "useRouter"
      pattern: "useRouter"
    - from: "app/editor/page.tsx"
      to: "@/lib/fs/commands"
      via: "scanFolderForAudio"
      pattern: "scanFolderForAudio"
    - from: "app/globals.css"
      to: "tailwind.config.js"
      via: "color references"
      pattern: "slate-deep|indigo-primary"
---

<objective>
Final integration and polish: connect Library and Editor pages, ensure consistent styling, and fix any remaining issues to match the UI mocks.

Purpose: Create a seamless user experience where navigation works end‑to‑end and the visual design matches the provided mocks.
Output: Fully functional three‑page UI with correct navigation, consistent styling, and no regressions from previous phases.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-advanced-features-scalability/03-CONTEXT.md
@.planning/phases/03-advanced-features-scalability/03-02-SUMMARY.md
@.planning/phases/03-advanced-features-scalability/03-03-SUMMARY.md
@.planning/phases/03-advanced-features-scalability/03-04-SUMMARY.md
@.planning/phases/03-advanced-features-scalability/03-05-SUMMARY.md

# Existing components to adjust
@src/components/Dashboard.tsx (may be retired)
@src/components/RecordingsList.tsx (legacy)
@src/components/TranscriptionModal.tsx (legacy)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Connect Library table to Editor page</name>
  <files>src/components/RecordingsTable.tsx, app/library/page.tsx</files>
  <action>
    1. **Update `RecordingsTable.tsx`:**
       - Import `useRouter` from `next/navigation`
       - Add `router.push(`/editor?recording=${recording.id}`)` on row click
       - Optional: highlight selected row based on current query param

    2. **Update `app/library/page.tsx`:**
       - Ensure `RecordingsTable` receives `onSelect` prop that triggers navigation
       - Alternatively, handle navigation in page component and pass `onSelect` callback

    3. **Test navigation:**
       - Clicking any row should navigate to `/editor?recording=...`
       - The Editor page should load (even if data not yet wired)

    4. **Preserve existing functionality:** The table should still display recordings with correct status badges.

    This task enables the primary user flow: Library → Editor.
  </action>
  <verify>
    - Clicking a table row navigates to Editor page with correct query parameter
    - Browser URL updates accordingly
    - No console errors during navigation
  </verify>
  <done>Library table rows navigate to Editor page with recording ID.</done>
</task>

<task type="auto">
  <name>Task 2: Improve Editor page data loading</name>
  <files>app/editor/page.tsx, src/components/PlayerSidebar.tsx</files>
  <action>
    Enhance the Editor page to properly load recording data and transcript based on the query parameter:

    1. **Load all recordings once:** Use `scanFolderForAudio` on mount to get the full list (cache if possible)
    2. **Find matching recording:** When `recording` query param changes, find the matching `AudioItem` from the list
    3. **Load transcript:** Call `readTranscript` for that recording path
    4. **Generate AI insights:** Trigger `generateSummary` if not already cached
    5. **Pass data to components:**
       - `PlayerSidebar` receives the `AudioItem`
       - `TranscriptView` receives the transcript segments
       - `InsightsSidebar` receives summary, actions, topics

    6. **Handle missing recording:** If ID not found, show a "Recording not found" message and link back to Library

    7. **Improve loading states:** Show spinners while transcript/summary are being loaded

    Ensure the Editor page works end‑to‑end: selecting a recording in Library loads its data in Editor.
  </action>
  <verify>
    - Editor page loads the correct recording based on query param
    - Transcript appears for transcribed recordings
    - AI summary generates (or shows placeholder)
    - Missing recording shows appropriate error
  </verify>
  <done>Editor page correctly loads recording data and transcript from query parameter.</done>
</task>

<task type="auto">
  <name>Task 3: Polish styling and global fixes</name>
  <files>src/components/Header.tsx, src/components/Footer.tsx, app/globals.css</files>
  <action>
    Apply final styling polish to match the mocks exactly:

    1. **Update `Header.tsx`:**
       - Conditionally show "New Recording" button only on Library page (`usePathname` check)
       - Ensure active link highlighting works correctly for all routes
       - Match exact spacing and typography from mock

    2. **Update `Footer.tsx`:**
       - Accept optional `leftContent` and `rightContent` props for flexibility
       - Ensure library and editor footers match mock spacing

    3. **Add global CSS styles in `app/globals.css`:**
       - Custom scrollbar class (from mock):
         ```
         .custom-scrollbar::-webkit-scrollbar { width: 4px; }
         .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
         .custom-scrollbar::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
         ```
       - Table row hover class:
         ```
         .table-row-hover:hover { background-color: rgba(30, 41, 59, 0.4); }
         ```
       - Ensure `body` has `background-color: #0f172a` (slate‑deep)

    4. **Remove legacy components:** Deprecate `Dashboard`, `RecordingsList`, `TranscriptionModal` (comment out imports but don't delete yet)

    5. **Verify consistency:** Check all pages use the same color palette, font sizes, and spacing as mocks.

    This task ensures the UI is visually cohesive and matches the design.
  </action>
  <verify>
    - New Recording button appears only on Library page
    - Custom scrollbar appears on scrollable elements
    - Table rows have hover effect
    - All pages share the same deep slate background
    - No visual regressions
  </verify>
  <done>Styling polished, global CSS applied, header conditional button working.</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Full user flow: Library → Editor → Library works seamlessly
2. Editor page loads correct recording data
3. All styling matches mocks (colors, spacing, scrollbars)
4. No console errors or TypeScript errors
5. Build succeeds: `npm run build`
</verification>

<success_criteria>
- [ ] Clicking a library table row navigates to editor with correct recording
- [ ] Editor page loads recording data and transcript based on query param
- [ ] New Recording button appears only on Library page
- [ ] Custom scrollbar styles apply to all scrollable areas
- [ ] Table rows have hover effect matching mock
- [ ] No broken functionality from previous phases
</success_criteria>

<output>
After completion, create `.planning/phases/03-advanced-features-scalability/03-06-SUMMARY.md`
</output>