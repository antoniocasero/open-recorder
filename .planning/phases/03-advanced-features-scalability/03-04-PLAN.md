---
phase: 03-advanced-features-scalability
plan: 04
type: execute
wave: 3
depends_on: ["03-03"]
files_modified:
  - src/components/TranscriptView.tsx
  - src/components/SearchBar.tsx
  - app/editor/page.tsx
autonomous: true
must_haves:
  truths:
    - "Transcript displays speaker‑segmented lines with formatted timestamps"
    - "Clicking a timestamp seeks audio player to that position"
    - "Search bar filters transcript lines by keyword (live update)"
    - "Matching keywords are highlighted in transcript text"
    - "Footer shows correct word count based on transcript"
  artifacts:
    - path: "src/components/TranscriptView.tsx"
      provides: "Speaker‑segmented transcript view with timestamp seeking"
      exports: "TranscriptView"
      min_lines: 80
    - path: "src/components/SearchBar.tsx"
      provides: "Search input for transcript keywords"
      exports: "SearchBar"
      min_lines: 25
    - path: "app/editor/page.tsx"
      provides: "Updated editor page with integrated transcript and search"
      contains: "TranscriptView|SearchBar"
  key_links:
    - from: "src/components/TranscriptView.tsx"
      to: "@/lib/transcription/commands"
      via: "readTranscript data"
      pattern: "readTranscript"
    - from: "app/editor/page.tsx"
      to: "src/components/TranscriptView.tsx"
      via: "import and render"
      pattern: "<TranscriptView"
    - from: "app/editor/page.tsx"
      to: "src/components/SearchBar.tsx"
      via: "import and render"
      pattern: "<SearchBar"
---

<objective>
Build the transcript viewing and search functionality for the Editor page, including speaker diarization, click‑to‑play timestamps, and keyword highlighting.

Purpose: Enable users to read, search, and navigate through transcripts with visual cues for speakers and search matches.
Output: Fully functional transcript view integrated into Editor page with real‑time search and audio seeking.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-advanced-features-scalability/03-CONTEXT.md
@.planning/phases/03-advanced-features-scalability/03-03-SUMMARY.md (after 03-03 completes)

# Existing transcription components
@src/components/Transcription.tsx
@src/components/TranscriptionModal.tsx
@src/lib/transcription/commands.ts
@src/lib/transcription/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SearchBar component for transcript search</name>
  <files>src/components/SearchBar.tsx</files>
  <action>
    Create a dedicated search bar for the Editor page (similar to existing Dashboard search but simplified):

    1. **Props:** Accept `value` and `onChange` (controlled input)
    2. **Design matching mock:**
       - Container: `relative w-full max-w-md`
       - Magnifying glass icon (`search`) positioned absolutely left
       - Input: `bg-slate-900/50 border border-slate-border/50 rounded-lg pl-9 pr-4 py-1.5 text-xs focus:ring-1 focus:ring-indigo-primary`
       - Placeholder: "Search keywords..."
       - Text color: `text-slate-200`

    3. **Behavior:**
       - Updates parent state on every keystroke (no debouncing needed – filtering is cheap)
       - No clear button (keep simple)

    4. **Export:** `export function SearchBar({ value, onChange }: { value: string, onChange: (value: string) => void })`

    This component will be placed in the Editor page's header area.
  </action>
  <verify>
    - SearchBar renders with icon and input
    - Typing triggers onChange callback
    - Styling matches mock (border, rounded, padding)
  </verify>
  <done>SearchBar component ready for integration.</done>
</task>

<task type="auto">
  <name>Task 2: Create TranscriptView component with speaker segmentation</name>
  <files>src/components/TranscriptView.tsx</files>
  <action>
    Build a component that displays a transcript with speaker diarization and clickable timestamps:

    1. **Props:**
       - `transcript: TranscriptSegment[]` (define type: `{ speaker: string, text: string, start: number, end: number }`)
       - `currentTime: number` (optional, for highlighting active segment)
       - `onSeek: (time: number) => void` (callback when timestamp clicked)
       - `searchQuery: string` (for highlighting matches)

    2. **Render each segment as in mock:**
       - Left column: timestamp button (e.g., "02:14")
       - Right column: speaker label + transcript text
       - Active segment highlight: left border `border-l-2 border-indigo-primary` and indigo timestamp

    3. **Timestamp formatting:** Convert `start` seconds to "MM:SS" (minutes:seconds)

    4. **Speaker labels:**
       - If `speaker` is "Interviewer": style with `text-slate-500`
       - Else: `text-indigo-primary` (highlighted speaker)
       - Show small colored dot next to label

    5. **Text rendering:**
       - Split text into words, highlight words that match `searchQuery` (case‑insensitive)
       - Highlight style: `bg-indigo-primary/20 text-indigo-primary px-1 rounded font-semibold border border-indigo-primary/30`
       - Normal text: `text-slate-300` (interviewer) or `text-slate-200` (speaker)

    6. **Click behavior:** Clicking timestamp button calls `onSeek(start)`

    7. **Empty state:** If no transcript, show "No transcript available"

    8. **Use existing transcript data:** Adapt the `readTranscript` function to return segmented data (already returns `Transcript` type with segments). Use that.

    Export component and necessary types.
  </action>
  <verify>
    - Component renders multiple segments with correct styling
    - Timestamps are formatted correctly
    - Speaker labels use appropriate colors
    - Clicking timestamp triggers onSeek with correct time
    - Highlighting works for search matches
  </verify>
  <done>TranscriptView component fully functional with speaker diarization and search highlighting.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate transcript and search into Editor page</name>
  <files>app/editor/page.tsx</files>
  <action>
    Connect the new components to the Editor page:

    1. **Add state:**
       - `searchQuery: string`
       - `transcript: TranscriptSegment[] | null`
       - `currentTime: number` (track playback progress from Player)

    2. **Load transcript:** When `recording` changes, call `readTranscript` and parse into segments.

    3. **Update Editor page structure:**
       - Replace the placeholder "Transcript will go here" with `<TranscriptView ... />`
       - Pass `transcript`, `currentTime`, `onSeek`, `searchQuery`
       - Implement `onSeek` to seek the audio player (need to expose seek method from PlayerSidebar – use ref or callback)

    4. **Connect search bar:** Render `<SearchBar>` in the header area (already present), wire `value` and `onChange`.

    5. **Filter transcript segments:** When `searchQuery` is not empty, filter segments where `text` includes query (case‑insensitive). Pass filtered segments to `TranscriptView`.

    6. **Playback time sync:** Subscribe to Player's time updates (use effect, interval, or event). Update `currentTime` state to highlight active segment.

    7. **Word count:** Calculate total words from transcript and display in footer.

    Ensure the Editor page now looks like the mock: header with search, transcript view below, player sidebar, insights placeholder.
  </action>
  <verify>
    - Editor page loads transcript for selected recording
    - Search bar filters transcript lines in real time
    - Clicking a timestamp seeks audio playback
    - Highlighted keywords appear in transcript
    - Footer word count updates based on transcript
    - No performance issues (filtering is fast)
  </verify>
  <done>Editor page fully integrates transcript view with search and seeking.</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Open Editor page with a recording that has a transcript
2. Verify speaker segments appear with correct styling
3. Type in search bar – see filtering and highlighting
4. Click timestamps – audio seeks to that position
5. Check that word count in footer matches transcript
</verification>

<success_criteria>
- [ ] Transcript displays speaker‑segmented lines with formatted timestamps
- [ ] Clicking a timestamp seeks audio player to that position
- [ ] Search bar filters transcript lines by keyword (live update)
- [ ] Matching keywords are highlighted in transcript text
- [ ] Footer shows correct word count
</success_criteria>

<output>
After completion, create `.planning/phases/03-advanced-features-scalability/03-04-SUMMARY.md`
</output>